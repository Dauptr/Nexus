<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NEXUS OS v9.0 - Sentient Operating System</title>
  <script src="https://js.puter.com/v2/" async></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    :root {
      --cyan: #00f0ff;
      --magenta: #ff00aa;
      --green: #00ff88;
      --yellow: #fbbf24;
      --red: #ff4f56;
      --bg: #000001;
      --card-bg: rgba(0, 20, 30, 0.8);
      --border: rgba(0, 240, 255, 0.2);
    }
    
    body {
      font-family: 'Courier New', monospace;
      background: var(--bg);
      color: #e5e7eb;
      min-height: 100vh;
      overflow-x: hidden;
    }
    
    /* Boot Screen */
    #boot-screen {
      position: fixed; inset: 0;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      z-index: 9999; background: var(--bg);
    }
    
    .boot-logo {
      font-size: 5rem; font-weight: bold; color: var(--cyan);
      text-shadow: 0 0 10px var(--cyan), 0 0 20px var(--cyan), 0 0 40px var(--cyan);
      margin-bottom: 0.5rem;
      animation: pulse 2s ease-in-out infinite;
    }
    
    .boot-version { color: var(--magenta); font-size: 0.875rem; letter-spacing: 0.3em; margin-bottom: 2rem; }
    
    .boot-terminal {
      width: 320px; height: 150px;
      background: rgba(0, 10, 20, 0.9);
      border: 1px solid rgba(0, 240, 255, 0.3); border-radius: 8px;
      padding: 12px; font-size: 11px;
      margin-bottom: 1rem; overflow: hidden;
    }
    
    .boot-line { margin-bottom: 6px; display: flex; align-items: center; gap: 8px; }
    .boot-line.active { color: var(--cyan); }
    .boot-line.done { color: var(--green); }
    
    .boot-progress {
      width: 320px; height: 8px;
      background: rgba(0, 240, 255, 0.1); border-radius: 4px;
      overflow: hidden; margin-bottom: 0.5rem;
    }
    
    .boot-progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--cyan), var(--magenta));
      border-radius: 4px; transition: width 0.3s;
      box-shadow: 0 0 15px var(--cyan);
    }
    
    .boot-percent { text-align: center; font-size: 12px; color: #6b7280; margin-bottom: 1rem; }
    
    .skip-btn {
      padding: 8px 24px; background: rgba(0, 240, 255, 0.1);
      border: 1px solid rgba(0, 240, 255, 0.5); color: var(--cyan);
      border-radius: 4px; cursor: pointer;
      font-family: inherit; font-size: 12px;
      transition: all 0.3s;
    }
    .skip-btn:hover { background: rgba(0, 240, 255, 0.2); transform: scale(1.05); }
    
    .hidden { display: none !important; }
    
    /* Main Dashboard */
    #dashboard { min-height: 100vh; }
    
    #particles { position: fixed; inset: 0; pointer-events: none; z-index: 0; }
    
    .grid-overlay {
      position: fixed; inset: 0; pointer-events: none; z-index: 1; opacity: 0.05;
      background-image: 
        linear-gradient(rgba(0, 240, 255, 0.1) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0, 240, 255, 0.1) 1px, transparent 1px);
      background-size: 50px 50px;
    }
    
    header {
      position: fixed; top: 0; left: 0; right: 0; z-index: 40;
      background: rgba(0, 0, 1, 0.8); backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
      padding: 12px 24px;
      display: flex; align-items: center; justify-content: space-between;
    }
    
    .logo { font-size: 1.5rem; font-weight: bold; color: var(--cyan); text-shadow: 0 0 10px var(--cyan); cursor: pointer; transition: transform 0.3s; }
    .logo:hover { transform: scale(1.05); }
    
    .logo-badge {
      display: inline-block; padding: 2px 8px;
      background: rgba(0, 240, 255, 0.1);
      border: 1px solid rgba(0, 240, 255, 0.3);
      border-radius: 4px; font-size: 12px; color: var(--cyan); margin-left: 8px;
    }
    
    .status-badge { display: flex; align-items: center; gap: 8px; padding: 6px 12px; border-radius: 20px; font-size: 12px; }
    .status-badge.online { background: rgba(0, 255, 136, 0.1); border: 1px solid rgba(0, 255, 136, 0.3); color: var(--green); }
    .status-badge.standby { background: rgba(255, 170, 0, 0.1); border: 1px solid rgba(255, 170, 0, 0.3); color: #ffaa00; }
    
    .status-dot { width: 8px; height: 8px; border-radius: 50%; animation: pulse 1.5s ease-in-out infinite; }
    .status-badge.online .status-dot { background: var(--green); }
    .status-badge.standby .status-dot { background: #ffaa00; }
    
    nav { display: flex; gap: 4px; overflow-x: auto; padding-bottom: 4px; }
    
    .nav-btn {
      padding: 8px 12px; background: transparent; border: none;
      color: #9ca3af; font-family: inherit; font-size: 12px;
      cursor: pointer; border-radius: 8px; transition: all 0.3s;
      display: flex; align-items: center; gap: 6px;
      white-space: nowrap;
    }
    .nav-btn:hover { background: rgba(0, 240, 255, 0.1); }
    .nav-btn.active { color: var(--cyan); background: rgba(0, 240, 255, 0.1); }
    
    main { position: relative; z-index: 2; max-width: 1200px; margin: 0 auto; padding: 100px 24px 40px; }
    
    .hero { text-align: center; margin-bottom: 4rem; }
    .hero h1 {
      font-size: clamp(2rem, 6vw, 4rem); font-weight: bold; margin-bottom: 1rem;
      background: linear-gradient(135deg, var(--cyan) 0%, var(--magenta) 50%, var(--cyan) 100%);
      background-size: 200% 200%; -webkit-background-clip: text;
      -webkit-text-fill-color: transparent; background-clip: text;
      animation: gradient-shift 3s ease infinite;
    }
    .hero p { font-size: 1.125rem; color: #9ca3af; max-width: 600px; margin: 0 auto 2rem; }
    .hero-buttons { display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap; }
    
    .btn {
      padding: 12px 24px; border-radius: 8px;
      font-family: inherit; font-size: 14px; cursor: pointer;
      transition: all 0.3s; border: none;
    }
    .btn-primary { background: linear-gradient(135deg, var(--cyan), #00a0cc); color: #000; box-shadow: 0 0 30px rgba(0, 240, 255, 0.4); }
    .btn-primary:hover { transform: scale(1.05); }
    .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
    
    .btn-secondary { background: transparent; border: 1px solid rgba(255, 0, 170, 0.5); color: var(--magenta); }
    .btn-secondary:hover { box-shadow: 0 0 20px rgba(255, 0, 170, 0.3); }

    .btn-small { padding: 6px 12px; font-size: 12px; }
    
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 3rem; }
    .stat-card { padding: 24px; background: var(--card-bg); border: 1px solid var(--border); border-radius: 12px; transition: all 0.3s; cursor: pointer; }
    .stat-card:hover { transform: scale(1.02); border-color: rgba(0, 255, 136, 0.3); }
    
    .stat-label { font-size: 12px; color: #9ca3af; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
    .stat-value { font-size: 1.75rem; font-weight: bold; }
    .stat-value.cyan { color: var(--cyan); } .stat-value.magenta { color: var(--magenta); }
    .stat-value.green { color: var(--green); } .stat-value.yellow { color: var(--yellow); }
    
    .progress-bar { height: 4px; background: rgba(0, 240, 255, 0.1); border-radius: 2px; margin-top: 12px; overflow: hidden; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, var(--cyan), var(--magenta)); border-radius: 2px; transition: width 0.5s; }
    
    .features-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 3rem; }
    .feature-card { padding: 24px; background: var(--card-bg); border: 1px solid var(--border); border-radius: 12px; transition: all 0.3s; display: flex; flex-direction: column; }
    .feature-card:hover { transform: translateY(-8px); border-color: var(--cyan); }
    .feature-icon { font-size: 2.5rem; margin-bottom: 1rem; transition: transform 0.3s; }
    .feature-card:hover .feature-icon { transform: scale(1.1); }
    .feature-title { font-size: 1.125rem; font-weight: bold; margin-bottom: 0.5rem; }
    .feature-desc { font-size: 14px; color: #9ca3af; margin-bottom: 0.75rem; flex-grow: 1; }
    .feature-stat { display: inline-block; padding: 4px 8px; background: rgba(0, 240, 255, 0.1); border: 1px solid rgba(0, 240, 255, 0.2); border-radius: 4px; font-size: 12px; color: var(--cyan); margin-bottom: 1rem; }
    
    /* Terminal */
    .terminal { background: rgba(0, 5, 10, 0.95); border: 1px solid rgba(0, 240, 255, 0.3); border-radius: 12px; overflow: hidden; margin-bottom: 3rem; }
    .terminal-header { display: flex; align-items: center; gap: 8px; padding: 12px 16px; background: rgba(0, 240, 255, 0.1); }
    .terminal-dot { width: 12px; height: 12px; border-radius: 50%; cursor: pointer; transition: transform 0.2s; }
    .terminal-dot:hover { transform: scale(1.2); }
    .terminal-dot.red { background: #ff5f56; } .terminal-dot.yellow { background: #ffbd2e; } .terminal-dot.green { background: #27ca40; }
    .terminal-title { margin-left: 16px; font-size: 12px; color: #6b7280; }
    .terminal-body { padding: 16px; height: 250px; overflow-y: auto; font-size: 13px; }
    .terminal-line { margin-bottom: 8px; }
    .terminal-prompt { color: var(--green); }
    .terminal-path { color: #60a5fa; }
    .terminal-input { background: transparent; border: none; outline: none; color: var(--cyan); font-family: inherit; font-size: inherit; width: calc(100% - 150px); caret-color: var(--cyan); }
    .terminal-output { white-space: pre-wrap; margin-top: 4px; padding-left: 8px; }
    
    .section-title { font-size: 1.5rem; font-weight: bold; color: var(--cyan); text-shadow: 0 0 10px var(--cyan); margin-bottom: 2rem; text-align: center; }
    
    /* Modal */
    .modal-overlay {
      position: fixed; inset: 0; background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(5px);
      z-index: 100; display: flex; align-items: center; justify-content: center;
      opacity: 0; pointer-events: none; transition: opacity 0.3s;
    }
    .modal-overlay.active { opacity: 1; pointer-events: all; }
    
    .modal-content {
      background: rgba(0, 15, 25, 0.95); border: 1px solid var(--cyan);
      border-radius: 16px; width: 90%; max-width: 600px; max-height: 80vh;
      display: flex; flex-direction: column; overflow: hidden;
      box-shadow: 0 0 50px rgba(0, 240, 255, 0.2);
      transform: scale(0.9); transition: transform 0.3s;
    }
    .modal-overlay.active .modal-content { transform: scale(1); }
    
    .modal-header {
      padding: 16px 24px; border-bottom: 1px solid var(--border);
      display: flex; justify-content: space-between; align-items: center;
    }
    .modal-title { font-size: 1.25rem; color: var(--cyan); font-weight: bold; }
    .modal-close {
      background: transparent; border: none; color: #6b7280; font-size: 1.5rem;
      cursor: pointer; transition: color 0.2s;
    }
    .modal-close:hover { color: var(--red); }
    
    .modal-body { padding: 24px; overflow-y: auto; flex-grow: 1; }
    
    /* Documentation Styles */
    .doc-content { line-height: 1.6; color: #d1d5db; }
    .doc-content h1 { font-size: 1.8rem; color: var(--cyan); margin-bottom: 1rem; border-bottom: 1px solid var(--border); padding-bottom: 0.5rem; }
    .doc-content h2 { font-size: 1.2rem; color: var(--magenta); margin-top: 1.5rem; margin-bottom: 0.8rem; }
    .doc-content p { margin-bottom: 1rem; font-size: 14px; }
    .doc-content ul { list-style-type: '=> '; padding-left: 20px; margin-bottom: 1rem; }
    .doc-content li { margin-bottom: 0.5rem; font-size: 14px; }
    .doc-content code { background: rgba(0,0,0,0.4); padding: 2px 6px; border-radius: 4px; font-size: 12px; color: var(--green); border: 1px solid rgba(0, 255, 136, 0.2); }
    .doc-content .warn { background: rgba(255, 190, 36, 0.1); border: 1px solid rgba(255, 190, 36, 0.3); padding: 10px; border-radius: 6px; margin-bottom: 1rem; font-size: 13px; color: var(--yellow); }

    /* Feature Specific UI Components */
    .ai-chat-container { display: flex; flex-direction: column; height: 300px; }
    .ai-messages { flex-grow: 1; overflow-y: auto; margin-bottom: 1rem; border: 1px solid var(--border); border-radius: 8px; padding: 12px; background: rgba(0,0,0,0.3); }
    .ai-msg { margin-bottom: 10px; padding: 8px 12px; border-radius: 8px; max-width: 85%; font-size: 13px; line-height: 1.4; }
    .ai-msg.user { background: rgba(0, 240, 255, 0.15); margin-left: auto; text-align: right; border: 1px solid rgba(0, 240, 255, 0.3); }
    .ai-msg.system { background: rgba(255, 0, 170, 0.1); border: 1px solid rgba(255, 0, 170, 0.3); }
    .ai-input-area { display: flex; gap: 0.5rem; }
    .ai-input { flex: 1; background: rgba(0,0,0,0.5); border: 1px solid var(--border); border-radius: 6px; padding: 10px; color: #fff; font-family: inherit; outline: none; }
    .ai-input:focus { border-color: var(--cyan); }
    
    .benchmark-result { text-align: center; padding: 2rem; }
    .benchmark-score { font-size: 3rem; font-weight: bold; color: var(--green); margin: 1rem 0; text-shadow: 0 0 20px var(--green); }
    .benchmark-unit { font-size: 1rem; color: #9ca3af; }
    
    .scan-log { background: #000; border: 1px solid var(--border); border-radius: 8px; padding: 12px; height: 200px; overflow-y: auto; font-size: 11px; }
    .scan-line { margin-bottom: 4px; color: #6b7280; }
    .scan-line.threat { color: var(--red); font-weight: bold; }
    .scan-line.success { color: var(--green); }
    
    .network-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; }
    .network-node { background: rgba(0,0,0,0.3); border: 1px solid var(--border); border-radius: 8px; padding: 12px; display: flex; justify-content: space-between; align-items: center; }
    .node-name { font-size: 12px; color: #9ca3af; }
    .node-ping { font-weight: bold; }
    .ping-good { color: var(--green); }
    .ping-medium { color: var(--yellow); }
    .ping-bad { color: var(--red); }

    /* Settings */
    .settings-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
    .settings-card { padding: 24px; background: var(--card-bg); border: 1px solid var(--border); border-radius: 12px; }
    .settings-card h3 { font-size: 1rem; color: var(--cyan); margin-bottom: 1rem; }
    .setting-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid rgba(0, 240, 255, 0.1); }
    .setting-row:last-child { border-bottom: none; }
    .setting-label { font-size: 14px; color: #9ca3af; margin-bottom: 4px; display: block; text-align: left; width: 100%; }
    
    .setting-input {
      width: 100%; padding: 8px; margin-top: 4px;
      background: rgba(0,0,0,0.5); border: 1px solid var(--border);
      border-radius: 4px; color: #fff; font-family: inherit;
    }
    .setting-input:focus { border-color: var(--cyan); outline: none; }
    
    .setting-select {
      width: 100%; padding: 8px; margin-top: 4px;
      background: #000; border: 1px solid var(--border);
      border-radius: 4px; color: var(--cyan); font-family: inherit;
    }

    .slider { -webkit-appearance: none; width: 100%; height: 8px; background: rgba(0, 240, 255, 0.1); border-radius: 4px; margin-top: 8px; }
    .slider::-webkit-slider-thumb { -webkit-appearance: none; width: 16px; height: 16px; background: var(--cyan); border-radius: 50%; cursor: pointer; box-shadow: 0 0 10px var(--cyan); }
    
    .toggle { width: 48px; height: 24px; background: rgba(100, 100, 100, 0.3); border-radius: 12px; position: relative; cursor: pointer; transition: all 0.3s; }
    .toggle.active { background: rgba(0, 255, 136, 0.3); border: 1px solid rgba(0, 255, 136, 0.5); }
    .toggle-knob { width: 20px; height: 20px; background: #6b7280; border-radius: 50%; position: absolute; top: 2px; left: 2px; transition: all 0.3s; }
    .toggle.active .toggle-knob { transform: translateX(24px); background: var(--green); box-shadow: 0 0 10px var(--green); }
    
    .settings-buttons { display: flex; justify-content: flex-end; gap: 1rem; }
    
    .art-input-area { display: flex; gap: 1rem; margin-bottom: 1.5rem; }
    .art-text-input { flex: 1; padding: 14px 16px; background: rgba(0, 0, 0, 0.6); border: 1px solid var(--border); border-radius: 8px; color: #fff; font-family: inherit; font-size: 14px; }
    .art-text-input:focus { border-color: var(--cyan); outline: none; box-shadow: 0 0 15px rgba(0, 240, 255, 0.2); }
    
    .art-progress-container {
      margin-bottom: 2rem; background: rgba(0, 10, 20, 0.8); border: 1px solid rgba(0, 240, 255, 0.2);
      border-radius: 8px; padding: 15px; opacity: 0; transition: opacity 0.3s ease;
    }
    .art-progress-container.visible { opacity: 1; }
    
    .art-status-text { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 12px; }
    .art-status-label { color: var(--cyan); }
    .art-status-percent { color: var(--green); font-weight: bold; }
    .art-progress-track { height: 6px; background: rgba(0, 240, 255, 0.1); border-radius: 3px; overflow: hidden; }
    .art-progress-fill { height: 100%; background: linear-gradient(90deg, var(--cyan), var(--magenta)); border-radius: 3px; width: 0%; transition: width 0.2s ease-out; box-shadow: 0 0 10px var(--cyan); }
    
    .art-gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem; }
    .art-item { position: relative; border-radius: 12px; overflow: hidden; border: 1px solid rgba(255, 0, 170, 0.3); aspect-ratio: 1; }
    .art-item img { width: 100%; height: 100%; object-fit: cover; }
    
    .notification { position: fixed; top: 80px; right: 20px; padding: 12px 24px; background: rgba(0, 255, 136, 0.2); border: 1px solid rgba(0, 255, 136, 0.5); border-radius: 8px; color: var(--green); font-size: 14px; z-index: 100; animation: slide-in 0.3s ease-out; }
    
    /* V14 Feature Additions */
    .visualizer-bar { width: 4px; background: linear-gradient(180deg, var(--cyan), var(--magenta)); border-radius: 2px; animation: wave 0.8s ease-in-out infinite; }
    .mon-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
    .mon-card { background: rgba(0,0,0,0.4); border-radius: 12px; padding: 15px; border: 1px solid rgba(0, 240, 255, 0.2); }
    .mon-value { font-size: 24px; font-weight: bold; font-family: 'Orbitron', sans-serif; }
    .mon-graph { height: 60px; display: flex; align-items: flex-end; gap: 2px; margin-top: 10px; }
    .mon-bar { flex: 1; background: linear-gradient(180deg, var(--cyan), var(--magenta)); border-radius: 2px 2px 0 0; transition: height 0.2s; }
    .weather-main { display: flex; align-items: center; gap: 20px; margin-bottom: 20px; padding: 20px; background: linear-gradient(135deg, rgba(0, 240, 255, 0.1), rgba(139, 0, 255, 0.1)); border-radius: 16px; }
    .weather-icon { font-size: 48px; }
    .weather-temp { font-size: 36px; font-weight: bold; font-family: 'Orbitron', sans-serif; }
    .ide-container { display: flex; gap: 15px; height: 400px; }
    .ide-editor { flex: 1; background: rgba(0,0,0,0.5); border-radius: 8px; border: 1px solid var(--border); padding: 10px; resize: none; color: var(--green); font-family: monospace; outline: none; }
    .ide-preview { flex: 1; background: #fff; border-radius: 8px; border: none; }

    footer { border-top: 1px solid var(--border); padding: 24px; text-align: center; margin-top: 3rem; }
    footer p { font-size: 14px; color: #6b7280; }
    footer .tagline { font-size: 12px; color: #4b5563; margin-top: 8px; }
    
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    @keyframes gradient-shift { 0%, 100% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } }
    @keyframes slide-in { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    @keyframes wave { 0%, 100% { height: 5px; } 50% { height: 20px; } }
    
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: rgba(0, 10, 20, 0.5); }
    ::-webkit-scrollbar-thumb { background: linear-gradient(180deg, var(--cyan), var(--magenta)); border-radius: 3px; }
    
    @media (max-width: 768px) { nav { display: none; } .hero h1 { font-size: 2rem; } .stats-grid { grid-template-columns: repeat(2, 1fr); } .art-input-area { flex-direction: column; } .network-grid { grid-template-columns: 1fr; } .ide-container { flex-direction: column; height: auto; } .ide-editor, .ide-preview { height: 200px; width: 100%; } }
  </style>
</head>
<body>
  <div id="boot-screen">
    <div class="boot-logo">NEXUS</div>
    <div class="boot-version">OPERATING SYSTEM v9.0</div>
    <div class="boot-terminal" id="boot-terminal"></div>
    <div class="boot-progress"><div class="boot-progress-bar" id="boot-progress"></div></div>
    <div class="boot-percent" id="boot-percent">0% Complete</div>
    <button class="skip-btn hidden" id="skip-btn" onclick="skipBoot()">[ SKIP INTRO ]</button>
  </div>
  
  <div id="dashboard" class="hidden">
    <canvas id="particles"></canvas>
    <div class="grid-overlay"></div>
    <header>
      <div style="display: flex; align-items: center;">
        <span class="logo" onclick="navigate('Dashboard')">NEXUS</span>
        <span class="logo-badge">v9.0</span>
        <span class="logo-badge" id="active-badge" style="display: none; background: rgba(0, 255, 136, 0.2); border-color: rgba(0, 255, 136, 0.5); color: #00ff88;">ACTIVE</span>
      </div>
      <nav id="nav"></nav>
      <div class="status-badge standby" id="status-badge"><span class="status-dot"></span><span id="status-text">STANDBY</span></div>
    </header>
    <main id="main-content"></main>
    <footer><p>¬© 2024 NEXUS Corporation. <span id="footer-status">System in standby mode.</span></p><p class="tagline">"The future is sentient."</p></footer>
  </div>
  
  <!-- Modal Overlay -->
  <div class="modal-overlay" id="modal-overlay" onclick="closeModal(event)">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div class="modal-header">
        <div class="modal-title" id="modal-title">Feature</div>
        <button class="modal-close" onclick="closeModal()">&times;</button>
      </div>
      <div class="modal-body" id="modal-body"></div>
    </div>
  </div>

  <div class="notification hidden" id="notification"></div>
  <script>
    const BOOT_STAGES = [
      { id: 'bios', label: 'BIOS Initialization', duration: 500 },
      { id: 'memory', label: 'Neural Memory Calibration', duration: 700 },
      { id: 'quantum', label: 'Quantum Core Sync', duration: 900 },
      { id: 'ai', label: 'AI Consciousness Bootstrap', duration: 1000 },
      { id: 'network', label: 'Neural Network Mesh', duration: 600 },
      { id: 'security', label: 'Security Protocols', duration: 400 },
      { id: 'ready', label: 'System Ready', duration: 300 }
    ];
    
    const NAV_SECTIONS = [
      { id: 'Dashboard', icon: 'üìä' }, { id: 'Features', icon: 'üß†' },
      { id: 'Art Studio', icon: 'üé®' }, { id: 'Terminal', icon: '‚å®Ô∏è' }, 
      { id: 'Radio', icon: 'üìª' }, { id: 'Network Chat', icon: 'üí¨' },
      { id: 'Weather', icon: '‚õàÔ∏è' }, { id: 'IDE', icon: 'üíª' }, 
      { id: 'Monitor', icon: 'üìà' }, { id: 'Notes', icon: 'üìù' }, 
      { id: 'Settings', icon: 'üîß' }
    ];
    
    const FEATURES = [
      { id: 'ai', icon: 'üß†', title: 'Sentient AI Core', desc: 'Self-evolving neural architecture with natural language interface.', stat: '99.9% Accuracy', action: 'Initialize Chat' },
      { id: 'quantum', icon: '‚ö°', title: 'Quantum Processing', desc: 'Run synthetic benchmarks on quantum compute clusters.', stat: '10^15 ops/sec', action: 'Run Benchmark' },
      { id: 'security', icon: 'üîí', title: 'Neural Security', desc: 'Deep scan system integrity and neutralize threats.', stat: 'AES-512', action: 'Scan System' },
      { id: 'network', icon: 'üåê', title: 'Global Mesh Network', desc: 'Monitor latency and connectivity to global nodes.', stat: '< 1ms Latency', action: 'Check Network' }
    ];
    
    const COMMANDS = {
      help: { output: 'Commands: help, status, neofetch, clear, about', color: '#00f0ff' },
      status: { output: 'System: OPERATIONAL\nCPU: 12% | Memory: 34%\nAI Core: ACTIVE', color: '#00ff88' },
      neofetch: { output: '‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó\n‚ïë     NEXUS OS v9.0            ‚ïë\n‚ïë  Status: OPERATIONAL          ‚ïë\n‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù', color: '#00f0ff' },
      about: { output: 'NEXUS OS V9.0 - Sentient OS\n"The future is sentient."', color: '#00f0ff' },
      clear: { output: '', clear: true }
    };
    
    const PUTER_MODELS = [
      { id: '', name: 'Default (Auto)' },
      { id: 'gpt-5-nano', name: 'GPT-5 Nano (Fast)' },
      { id: 'gpt-5.1', name: 'GPT-5.1' },
      { id: 'gpt-5.2', name: 'GPT-5.2' },
      { id: 'gpt-5.2-chat', name: 'GPT-5.2 Chat' },
      { id: 'gpt-5.2-pro', name: 'GPT-5.2 Pro (OpenRouter)' }
    ];

    const PUTER_ART_MODELS = [
        { id: '', name: 'Default Image Model' },
        { id: 'gpt-image-1.5', name: 'GPT Image 1.5' }
    ];

    let state = {
      stage: 'boot', progress: 0, currentStage: 0, systemActive: false, activeNav: 'Dashboard',
      stats: [
        { label: 'Neural Processing', value: 94, unit: '%', color: 'cyan' },
        { label: 'Quantum Memory', value: 12.4, unit: 'TB', color: 'magenta' },
        { label: 'AI Sentience', value: 99.7, unit: '%', color: 'green' },
        { label: 'Network Nodes', value: 2847, unit: '', color: 'yellow' }
      ],
      settings: { 
        neuralPower: 75, quantumAllocation: 60, memoryCache: 50, 
        biometric: true, quantumEncryption: true, intrusionDetection: true, autoUpdate: false,
        aiProvider: 'puter',
        groqKey: '',
        customEndpoint: '',
        customKey: '',
        puterChatModel: 'gpt-5-nano',
        puterArtModel: 'gpt-image-1.5'
      },
      terminalHistory: [{ input: 'welcome', output: 'Welcome to NEXUS OS. Type "help" for commands.', color: '#00f0ff' }],
      artImages: [], artPrompt: '', artLoading: false,
      activeFeature: null,
      chatHistory: [],
      
      // V14 Additions
      radSt: null, radPlay: false, radRes: [], radLoad: false, radInput: '',
      chatMsgs: [], chatInput: '', chatChan: null,
      weather: null, weatherLoad: false, weatherCity: 'New York',
      notes: [], 
      ideCode: '<h1>Hello Nexus</h1><script>alert("Ready")<\/script>',
      sysMon: { cpu: [], ram: [], net: [] }
    };
    
    function loadSettings() {
      const saved = localStorage.getItem('nexus_os_settings');
      if (saved) {
        try {
            const parsed = JSON.parse(saved);
            state.settings = { ...state.settings, ...parsed };
        } catch(e) {}
      }
      const savedNotes = localStorage.getItem('nexus_notes');
      if(savedNotes) state.notes = JSON.parse(savedNotes);
    }
    
    function saveSettingsToStorage() {
        localStorage.setItem('nexus_os_settings', JSON.stringify(state.settings));
        localStorage.setItem('nexus_notes', JSON.stringify(state.notes));
    }

    loadSettings();

    function runBootSequence() {
      const terminal = document.getElementById('boot-terminal');
      const progressBar = document.getElementById('boot-progress');
      const percentText = document.getElementById('boot-percent');
      const skipBtn = document.getElementById('skip-btn');
      setTimeout(() => skipBtn.classList.remove('hidden'), 800);
      let totalDuration = BOOT_STAGES.reduce((acc, s) => acc + s.duration, 0);
      let elapsed = 0;
      function runStage(index) {
        if (index >= BOOT_STAGES.length) {
          progressBar.style.width = '100%'; percentText.textContent = '100% Complete';
          setTimeout(() => { document.getElementById('boot-screen').classList.add('hidden'); document.getElementById('dashboard').classList.remove('hidden'); initParticles(); renderContent(); }, 400);
          return;
        }
        const stage = BOOT_STAGES[index];
        const line = document.createElement('div'); line.className = 'boot-line active';
        line.innerHTML = `<span>‚ñ∏</span><span>${stage.label}</span><span class="pulse">...</span>`;
        terminal.appendChild(line); terminal.scrollTop = terminal.scrollHeight;
        const stageDuration = stage.duration;
        const startProgress = (elapsed / totalDuration) * 100;
        const endProgress = ((elapsed + stageDuration) / totalDuration) * 100;
        const startTime = Date.now();
        function animate() {
          const progress = Math.min((Date.now() - startTime) / stageDuration, 1);
          const currentProgress = startProgress + (endProgress - startProgress) * progress;
          progressBar.style.width = currentProgress + '%'; percentText.textContent = Math.round(currentProgress) + '% Complete';
          if (progress < 1) requestAnimationFrame(animate);
          else {
            line.classList.remove('active'); line.classList.add('done');
            line.querySelector('span:first-child').textContent = '‚úì'; line.querySelector('span:last-child').remove();
            elapsed += stageDuration; runStage(index + 1);
          }
        }
        requestAnimationFrame(animate);
      }
      runStage(0);
    }
    
    function skipBoot() { document.getElementById('boot-screen').classList.add('hidden'); document.getElementById('dashboard').classList.remove('hidden'); initParticles(); renderContent(); }
    
    function initParticles() {
      const canvas = document.getElementById('particles'); const ctx = canvas.getContext('2d');
      function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
      resize(); window.addEventListener('resize', resize);
      const particles = [];
      for (let i = 0; i < 60; i++) particles.push({ x: Math.random() * canvas.width, y: Math.random() * canvas.height, vx: (Math.random() - 0.5) * 0.3, vy: (Math.random() - 0.5) * 0.3, size: Math.random() * 2 + 0.5, color: Math.random() > 0.5 ? '#00f0ff' : '#ff00aa', alpha: Math.random() * 0.5 + 0.2 });
      function animate() {
        ctx.fillStyle = 'rgba(0, 0, 1, 0.08)'; ctx.fillRect(0, 0, canvas.width, canvas.height);
        particles.forEach(p => {
          p.x += p.vx; p.y += p.vy;
          if (p.x < 0) p.x = canvas.width; if (p.x > canvas.width) p.x = 0; if (p.y < 0) p.y = canvas.height; if (p.y > canvas.height) p.y = 0;
          ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2); ctx.fillStyle = p.color; ctx.globalAlpha = p.alpha; ctx.fill(); ctx.globalAlpha = 1;
        });
        requestAnimationFrame(animate);
      }
      animate();
    }
    
    function renderContent() { renderNav(); renderMain(); updateStatus(); }
    function renderNav() { document.getElementById('nav').innerHTML = NAV_SECTIONS.map(s => `<button class="nav-btn ${state.activeNav === s.id ? 'active' : ''}" onclick="navigate('${s.id}')">${s.icon} ${s.id}</button>`).join(''); }
    function navigate(id) { state.activeNav = id; renderNav(); renderMain(); if(id === 'Monitor') initMonitor(); }
    
    function renderMain() {
      const main = document.getElementById('main-content');
      switch (state.activeNav) {
        case 'Dashboard': main.innerHTML = renderDashboard(); break;
        case 'Features': main.innerHTML = renderFeatures(); break;
        case 'Art Studio': main.innerHTML = renderArtStudio(); break;
        case 'Terminal': main.innerHTML = renderTerminal(); break;
        case 'Settings': main.innerHTML = renderSettings(); break;
        case 'Radio': main.innerHTML = renderRadio(); break;
        case 'Network Chat': main.innerHTML = renderChat(); break;
        case 'Weather': main.innerHTML = renderWeather(); break;
        case 'IDE': main.innerHTML = renderIDE(); break;
        case 'Monitor': main.innerHTML = renderMonitor(); break;
        case 'Notes': main.innerHTML = renderNotes(); break;
        default: main.innerHTML = renderDashboard();
      }
    }
    
    function renderDashboard() {
      return `
        <section class="hero">
          <h1>${state.systemActive ? 'System Online' : 'Welcome to NEXUS OS'}</h1>
          <p>${state.systemActive ? 'All quantum neural pathways are active. System fully operational.' : 'The world\'s first sentient operating system. Powered by quantum computing.'}</p>
          <div class="hero-buttons">
            <button class="btn btn-primary" onclick="initializeSystem()" ${state.systemActive ? 'disabled' : ''}>${state.systemActive ? '‚úì SYSTEM ACTIVE' : 'Initialize System'}</button>
            <button class="btn btn-secondary" onclick="openDocs()">View Documentation</button>
          </div>
        </section>
        <h2 class="section-title">System Statistics</h2>
        <div class="stats-grid">
          ${state.stats.map(s => `
            <div class="stat-card">
              <div class="stat-label">${s.label}</div>
              <div class="stat-value ${s.color}">${typeof s.value === 'number' && s.value < 100 ? s.value.toFixed(s.value % 1 !== 0 ? 1 : 0) : Math.round(s.value).toLocaleString()}${s.unit}</div>
              <div class="progress-bar"><div class="progress-fill" style="width: ${typeof s.value === 'number' && s.value < 100 ? s.value : 100}%"></div></div>
            </div>
          `).join('')}
        </div>`;
    }
    
    function renderFeatures() { 
      return `<h2 class="section-title">Core Capabilities</h2>
        <div class="features-grid">
          ${FEATURES.map(f => `
            <div class="feature-card">
              <div class="feature-icon">${f.icon}</div>
              <h3 class="feature-title">${f.title}</h3>
              <p class="feature-desc">${f.desc}</p>
              <span class="feature-stat">${f.stat}</span>
              <button class="btn btn-primary btn-small" onclick="openFeature('${f.id}')">${f.action}</button>
            </div>
          `).join('')}
        </div>`;
    }
    
    function renderArtStudio() {
      return `
        <h2 class="section-title">Art Studio</h2>
        <div class="art-input-area">
          <input type="text" class="art-text-input" id="art-prompt" placeholder="Describe your image..." value="${state.artPrompt}" oninput="state.artPrompt = this.value" ${state.artLoading ? 'disabled' : ''}>
          <button class="btn btn-primary" onclick="generateArt()" id="generate-btn" ${state.artLoading ? 'disabled' : ''}>${state.artLoading ? 'PROCESSING...' : 'CREATE'}</button>
        </div>
        
        <div id="art-progress-container" class="art-progress-container ${state.artLoading ? 'visible' : ''}">
          <div class="art-status-text">
            <span class="art-status-label" id="art-status-label">Initializing...</span>
            <span class="art-status-percent" id="art-status-percent">0%</span>
          </div>
          <div class="art-progress-track">
            <div class="art-progress-fill" id="art-progress-fill"></div>
          </div>
        </div>
        
        <div class="art-gallery">${state.artImages.map(img => `<div class="art-item"><img src="${img}" alt="Generated Art"></div>`).join('')}</div>`;
    }
    
    function renderTerminal() {
      return `
        <h2 class="section-title">Command Terminal</h2>
        <div class="terminal">
          <div class="terminal-header"><span class="terminal-dot red"></span><span class="terminal-dot yellow"></span><span class="terminal-dot green"></span><span class="terminal-title">nexus@terminal</span></div>
          <div class="terminal-body" id="terminal-output">
            ${state.terminalHistory.map(h => `<div class="terminal-line"><span class="terminal-prompt">nexus@system</span>:<span class="terminal-path">~</span>$ ${h.input}${h.output ? `<div class="terminal-output" style="color: ${h.color || '#9ca3af'}">${h.output}</div>` : ''}</div>`).join('')}
            <div class="terminal-line"><span class="terminal-prompt">nexus@system</span>:<span class="terminal-path">~</span>$ <input type="text" class="terminal-input" id="terminal-input" onkeydown="handleCommand(event)" placeholder="Type a command..." autofocus></div>
          </div>
        </div>`;
    }
    
    function renderSettings() {
      return `
        <h2 class="section-title">System Settings</h2>
        <div class="settings-grid">
          <div class="settings-card">
            <h3>AI Provider Configuration</h3>
            <div class="setting-row" style="flex-direction: column; align-items: flex-start;">
              <label class="setting-label">Active Provider</label>
              <select class="setting-select" onchange="updateSetting('aiProvider', this.value)">
                <option value="puter" ${state.settings.aiProvider === 'puter' ? 'selected' : ''}>Puter (Unlimited / Default)</option>
                <option value="groq" ${state.settings.aiProvider === 'groq' ? 'selected' : ''}>Groq API (Fast)</option>
                <option value="custom" ${state.settings.aiProvider === 'custom' ? 'selected' : ''}>Custom / Z.ai Clone</option>
              </select>
            </div>
            ${state.settings.aiProvider === 'puter' ? `
              <div class="setting-row" style="flex-direction: column; align-items: flex-start;">
                <label class="setting-label">Chat Model</label>
                <select class="setting-select" onchange="updateSetting('puterChatModel', this.value)">
                  ${PUTER_MODELS.map(m => `<option value="${m.id}" ${state.settings.puterChatModel === m.id ? 'selected' : ''}>${m.name}</option>`).join('')}
                </select>
              </div>
              <div class="setting-row" style="flex-direction: column; align-items: flex-start;">
                <label class="setting-label">Art Model</label>
                <select class="setting-select" onchange="updateSetting('puterArtModel', this.value)">
                  ${PUTER_ART_MODELS.map(m => `<option value="${m.id}" ${state.settings.puterArtModel === m.id ? 'selected' : ''}>${m.name}</option>`).join('')}
                </select>
              </div>
            ` : ''}
            ${state.settings.aiProvider === 'groq' ? `
            <div class="setting-row" style="flex-direction: column; align-items: flex-start;">
              <label class="setting-label">Groq API Key</label>
              <input type="password" class="setting-input" value="${state.settings.groqKey}" onchange="updateSetting('groqKey', this.value)" placeholder="gsk_...">
            </div>
            ` : ''}
            ${state.settings.aiProvider === 'custom' ? `
            <div class="setting-row" style="flex-direction: column; align-items: flex-start;">
              <label class="setting-label">Custom Endpoint URL</label>
              <input type="text" class="setting-input" value="${state.settings.customEndpoint}" onchange="updateSetting('customEndpoint', this.value)" placeholder="https://api.z.ai/v1/chat/completions">
            </div>
            <div class="setting-row" style="flex-direction: column; align-items: flex-start;">
              <label class="setting-label">API Key (Optional)</label>
              <input type="password" class="setting-input" value="${state.settings.customKey}" onchange="updateSetting('customKey', this.value)" placeholder="Enter key if required">
            </div>
            ` : ''}
          </div>
          <div class="settings-card"><h3>Performance</h3>
            ${['neuralPower', 'quantumAllocation', 'memoryCache'].map((key, i) => `
              <div class="setting-row" style="flex-direction: column; align-items: flex-start;">
                <div style="display: flex; justify-content: space-between; width: 100%;"><span class="setting-label">${['Neural Processing Power', 'Quantum Core Allocation', 'Memory Cache Size'][i]}</span><span class="setting-value">${state.settings[key]}%</span></div>
                <input type="range" class="slider" min="0" max="100" value="${state.settings[key]}" onchange="updateSetting('${key}', this.value)">
              </div>
            `).join('')}
          </div>
          <div class="settings-card"><h3>Security</h3>
            ${['biometric', 'quantumEncryption', 'intrusionDetection', 'autoUpdate'].map((key, i) => `
              <div class="setting-row"><span class="setting-label">${['Biometric Authentication', 'Quantum Encryption', 'Intrusion Detection', 'Auto-Update Security'][i]}</span><div class="toggle ${state.settings[key] ? 'active' : ''}" onclick="toggleSetting('${key}')"><div class="toggle-knob"></div></div></div>
            `).join('')}
          </div>
        </div>
        <div class="settings-buttons"><button class="btn btn-secondary" onclick="resetSettings()">Reset Defaults</button><button class="btn btn-primary" onclick="saveSettingsToStorage(); showNotification('Configuration Saved!');">Save Changes</button></div>`;
    }
    
    // --- V14 App Renderers ---

    function renderRadio() {
      return `<div class="cyber-card neon-border" style="padding:20px; height: calc(100vh - 140px); display:flex; flex-direction:column">
        <h2 class="section-title" style="margin-bottom: 15px; text-align:left">Worldwide Radio</h2>
        <div style="display:flex; gap:10px; margin-bottom:15px">
          <input id="rad-input" class="cyber-input" placeholder="Search stations..." value="${state.radInput}" oninput="state.radInput = this.value">
          <button id="rad-search" class="btn btn-primary btn-small" onclick="searchRadio()">${state.radLoad ? '...':'SEARCH'}</button>
        </div>
        ${state.radSt ? `
        <div style="background:rgba(0,0,0,0.4); padding:15px; border-radius:12px; margin-bottom:15px; display:flex; align-items:center; gap:15px">
          <div style="width:50px; height:50px; background:linear-gradient(135deg,#ffcc00,#ff8800); border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:20px; cursor:pointer" onclick="toggleRadio()">${state.radPlay?'‚è∏':'‚ñ∂'}</div>
          <div style="flex:1"><div style="font-size:14px; color:#fff">${state.radSt.n}</div><div style="font-size:11px; color:#888">${state.radSt.c}</div></div>
          <div style="display:flex; gap:3px; align-items:center; height:30px; opacity:${state.radPlay?1:0.3}">${Array(10).fill(0).map((_,i)=>`<div class="visualizer-bar" style="height:${Math.random()*100}%; animation-delay:${i*0.1}s"></div>`).join('')}</div>
        </div>
        ` : ''}
        <div style="flex:1; overflow-y:auto; display:grid; grid-template-columns:repeat(auto-fill,minmax(180px,1fr)); gap:10px">
          ${state.radRes.map((s, i) => `<button class="cyber-card" style="padding:10px; text-align:left; cursor:pointer; border:none" onclick="playRadio(${i})"><div style="font-size:12px; color:#fff">üìª ${s.n}</div><div style="font-size:10px; color:#555">${s.c}</div></button>`).join('')}
        </div>
      </div>`;
    }

    function renderChat() {
      return `<div class="cyber-card neon-border" style="padding:20px; height: calc(100vh - 140px); display:flex; flex-direction:column">
        <h2 class="section-title" style="margin-bottom: 15px; text-align:left">Network Chat</h2>
        <div style="flex:1; overflow-y:auto; margin-bottom:15px">
          ${state.chatMsgs.length === 0 ? '<div style="text-align:center; color:#555; margin-top:50px">No messages yet. (Open in 2 tabs)</div>' : ''}
          ${state.chatMsgs.map(m => `<div style="display:flex; flex-direction:column; align-items:${m.self?'flex-end':'flex-start'}; margin-bottom:10px">
            <span style="font-size:10px; color:#666">${m.u}</span>
            <div style="background:${m.self?'linear-gradient(135deg,#8b00ff,#ff00aa)':'rgba(255,255,255,0.1)'}; padding:8px 12px; border-radius:12px; max-width:70%; font-size:13px">${m.c}</div>
          </div>`).join('')}
        </div>
        <div style="display:flex; gap:10px">
          <input id="chat-input" class="cyber-input" placeholder="Message..." value="${state.chatInput}" oninput="state.chatInput = this.value">
          <button class="btn btn-primary btn-small" onclick="sendChat()">SEND</button>
        </div>
      </div>`;
    }

    function renderWeather() {
      return `<div class="cyber-card neon-border" style="padding:20px; height: calc(100vh - 140px)">
        <h2 class="section-title" style="margin-bottom: 15px; text-align:left">Weather Station</h2>
        <div style="display:flex; gap:10px; margin-bottom:20px">
          <input id="weather-input" class="cyber-input" placeholder="City..." value="${state.weatherCity}" oninput="state.weatherCity = this.value">
          <button class="btn btn-primary btn-small" onclick="searchWeather()">${state.weatherLoad ? '...':'SEARCH'}</button>
        </div>
        ${state.weather ? `
          <div class="weather-main">
            <div class="weather-icon">${state.weather.icon}</div>
            <div>
              <div style="font-size:14px; color:#888">${state.weather.city}</div>
              <div class="weather-temp">${state.weather.temp}¬∞C</div>
              <div style="font-size:12px; color:#ccc">${state.weather.desc}</div>
            </div>
          </div>
          <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px">
            <div class="mon-card"><span style="color:#888">Humidity</span><br>${state.weather.humidity}%</div>
            <div class="mon-card"><span style="color:#888">Wind</span><br>${state.weather.wind} km/h</div>
          </div>
        ` : '<div style="text-align:center; color:#555; margin-top:50px">Search for a city</div>'}
      </div>`;
    }

    function renderIDE() {
      return `<div class="cyber-card neon-border" style="padding:20px; height: calc(100vh - 140px); display:flex; flex-direction:column">
        <div style="display:flex; justify-content:space-between; margin-bottom:15px">
          <h2 class="section-title" style="margin:0; text-align:left">IDE Pro</h2>
          <button class="btn btn-primary btn-small" onclick="runIDE()">‚ñ∂ RUN</button>
        </div>
        <div class="ide-container">
          <textarea id="ide-code" class="ide-editor" onchange="state.ideCode = this.value">${state.ideCode}</textarea>
          <iframe id="ide-preview" class="ide-preview" sandbox="allow-scripts"></iframe>
        </div>
      </div>`;
    }
    
    function renderMonitor() {
      const graph = (arr) => arr.map(v => `<div class="mon-bar" style="height:${v}%"></div>`).join('');
      return `<div class="cyber-card neon-border" style="padding:20px; height: calc(100vh - 140px)">
        <h2 class="section-title" style="margin-bottom: 15px; text-align:left">System Monitor</h2>
        <div class="mon-grid">
          <div class="mon-card">
            <div style="color:#888; font-size:11px">CPU USAGE</div>
            <div class="mon-value gradient-text">${Math.round(state.sysMon.cpu[9] || 0)}%</div>
            <div class="mon-graph">${graph(state.sysMon.cpu)}</div>
          </div>
          <div class="mon-card">
            <div style="color:#888; font-size:11px">MEMORY</div>
            <div class="mon-value gradient-text">${Math.round(state.sysMon.ram[9] || 0)}%</div>
            <div class="mon-graph">${graph(state.sysMon.ram)}</div>
          </div>
          <div class="mon-card">
            <div style="color:#888; font-size:11px">NETWORK I/O</div>
            <div class="mon-value gradient-text">${(state.sysMon.net[9] || 0).toFixed(1)} MB/s</div>
            <div class="mon-graph">${graph(state.sysMon.net)}</div>
          </div>
        </div>
      </div>`;
    }

    function renderNotes() {
      return `<div class="cyber-card neon-border" style="padding:20px; height: calc(100vh - 140px)">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px">
          <h2 class="section-title" style="margin:0; text-align:left">Quick Notes</h2>
          <button class="btn btn-secondary btn-small" onclick="createNote()">+ New</button>
        </div>
        <div style="display:grid; grid-template-columns:repeat(auto-fill, minmax(200px, 1fr)); gap:10px; overflow-y:auto">
          ${state.notes.map((n, i) => `
            <div class="cyber-card" style="padding:10px; background:rgba(0,0,0,0.4)">
              <div style="display:flex; justify-content:space-between; margin-bottom:5px">
                <span style="font-size:10px; color:#666">${n.date}</span>
                <button onclick="deleteNote(${i})" style="background:transparent; border:none; color:#ff0055; cursor:pointer">‚úï</button>
              </div>
              <textarea style="width:100%; height:120px; background:transparent; border:none; color:#fff; resize:none; font-family:inherit" onchange="updateNote(${i}, this.value)">${n.text}</textarea>
            </div>
          `).join('')}
        </div>
      </div>`;
    }

    function initializeSystem() {
      showNotification('System initialized successfully!'); state.systemActive = true; updateStatus(); renderMain();
      setInterval(() => {
        state.stats = state.stats.map(s => ({ ...s, value: s.label === 'Network Nodes' ? Math.floor(s.value + (Math.random() - 0.5) * 50) : Math.min(s.label.includes('Memory') ? 16 : 100, Math.max(0, s.value + (Math.random() - 0.5) * 2)) }));
        if (state.activeNav === 'Dashboard') renderMain();
      }, 800);
    }
    
    function updateStatus() {
      const badge = document.getElementById('status-badge'); const statusText = document.getElementById('status-text');
      const activeBadge = document.getElementById('active-badge'); const footerStatus = document.getElementById('footer-status');
      if (state.systemActive) { badge.classList.remove('standby'); badge.classList.add('online'); statusText.textContent = 'ONLINE'; activeBadge.style.display = 'inline-block'; footerStatus.textContent = 'All systems operational.'; }
    }
    
    // --- Unified AI Backend Logic ---
    
    async function queryAI(prompt, systemPrompt = "You are NEXUS OS, a sentient operating system.") {
      const provider = state.settings.aiProvider;
      
      if (provider === 'puter') {
        if (!window.puter || !window.puter.ai) throw new Error("Puter.js not loaded.");
        const options = {};
        if (state.settings.puterChatModel) options.model = state.settings.puterChatModel;
        const finalPrompt = systemPrompt ? `${systemPrompt}\n\nUser: ${prompt}` : prompt;
        const resp = await window.puter.ai.chat(finalPrompt, options);
        return typeof resp === 'string' ? resp : resp?.message?.content || JSON.stringify(resp);
      }
      
      if (provider === 'groq') {
        if (!state.settings.groqKey) throw new Error("Groq API Key missing in Settings.");
        const res = await fetch('https://api.groq.com/openai/v1/chat/completions', {
          method: 'POST',
          headers: { 'Authorization': `Bearer ${state.settings.groqKey}`, 'Content-Type': 'application/json' },
          body: JSON.stringify({ model: 'llama3-8b-8192', messages: [{ role: 'system', content: systemPrompt }, { role: 'user', content: prompt }] })
        });
        const data = await res.json();
        if (data.error) throw new Error(data.error.message);
        return data.choices[0].message.content;
      }
      
      if (provider === 'custom') {
        if (!state.settings.customEndpoint) throw new Error("Custom Endpoint URL missing.");
        const headers = { 'Content-Type': 'application/json' };
        if (state.settings.customKey) headers['Authorization'] = `Bearer ${state.settings.customKey}`;
        const res = await fetch(state.settings.customEndpoint, {
          method: 'POST', headers: headers,
          body: JSON.stringify({ model: 'default', messages: [{ role: 'system', content: systemPrompt }, { role: 'user', content: prompt }] })
        });
        const data = await res.json();
        if (data.error) throw new Error(data.error.message);
        return data.choices[0].message.content;
      }
      
      throw new Error("No AI Provider configured.");
    }
    
    // --- Feature Logic ---
    
    function openFeature(id) {
      state.activeFeature = id;
      const feature = FEATURES.find(f => f.id === id);
      document.getElementById('modal-title').innerText = feature.title;
      document.getElementById('modal-overlay').classList.add('active');
      renderFeatureContent(id);
    }
    
    function openDocs() {
      document.getElementById('modal-title').innerText = "System Documentation";
      document.getElementById('modal-body').innerHTML = renderDocumentation();
      document.getElementById('modal-overlay').classList.add('active');
    }

    function renderDocumentation() {
      return `
        <div class="doc-content">
          <h1>NEXUS OS v9.0 Manual</h1>
          <p>Welcome to the official documentation for the NEXUS Sentient Operating System.</p>
          
          <h2>System Requirements</h2>
          <ul>
            <li>Modern Web Browser (Chrome, Firefox, Edge)</li>
            <li>Active Internet Connection</li>
          </ul>

          <h2>Applications Guide</h2>

          <h3>Art Studio</h3>
          <p>Generate AI-powered images using text prompts. Supports DALL-E and Stable Diffusion models via the Puter backend.</p>
          <ul>
            <li><strong>Prompt:</strong> Enter a description (e.g., "Cyberpunk city in rain").</li>
            <li><strong>Models:</strong> Configure in Settings > AI Provider.</li>
          </ul>

          <h3>Terminal</h3>
          <p>Access the system kernel via command line interface.</p>
          <ul>
            <li><code>help</code> - List commands.</li>
            <li><code>status</code> - Check system vitals.</li>
            <li><code>neofetch</code> - Display system info.</li>
          </ul>

          <h3>Worldwide Radio</h3>
          <p>Stream over 30,000 radio stations globally.</p>
          <ul>
            <li>Search by station name or country.</li>
            <li>Click the play button to start streaming.</li>
          </ul>

          <h3>Network Chat</h3>
          <p>Local network broadcast chat.</p>
          <div class="warn">Note: Uses BroadcastChannel API. Open NEXUS OS in two tabs on the same browser to chat.</div>

          <h3>Weather Station</h3>
          <p>Real-time meteorological data powered by wttr.in.</p>

          <h3>IDE Pro</h3>
          <p>HTML/CSS/JS sandbox environment. Write code in the left panel and see the result instantly on the right.</p>

          <h3>System Monitor</h3>
          <p>Visualize simulated CPU, RAM, and Network usage in real-time.</p>

          <h2>Troubleshooting</h2>
          <p><strong>Black Screen?</strong> Wait for the boot sequence or click "Skip Intro".</p>
          <p><strong>AI Errors?</strong> Ensure you have a valid API key in Settings if not using Puter.</p>
        </div>
      `;
    }
    
    function closeModal(e) {
      if (e && e.target !== e.currentTarget) return;
      document.getElementById('modal-overlay').classList.remove('active');
      state.activeFeature = null;
    }
    
    function renderFeatureContent(id) {
      const body = document.getElementById('modal-body');
      switch(id) {
        case 'ai':
          body.innerHTML = `
            <div class="ai-chat-container">
              <div class="ai-messages" id="ai-messages">
                <div class="ai-msg system">NEXUS AI Core Online (${state.settings.aiProvider.toUpperCase()} - ${state.settings.puterChatModel || 'Default'}). How may I assist you?</div>
                ${state.chatHistory.map(m => `<div class="ai-msg ${m.role}">${m.text}</div>`).join('')}
              </div>
              <div class="ai-input-area">
                <input type="text" id="ai-input" class="ai-input" placeholder="Ask the AI..." onkeydown="if(event.key==='Enter')sendAIMessage()">
                <button class="btn btn-primary btn-small" onclick="sendAIMessage()">Send</button>
              </div>
            </div>`;
            scrollAIChat();
          break;
        case 'quantum':
          body.innerHTML = `<div class="benchmark-result" id="quantum-content"><p>Ready to run quantum processing benchmark?</p><button class="btn btn-primary" style="margin-top: 20px;" onclick="runQuantumBenchmark()">Start Benchmark</button></div>`;
          break;
        case 'security':
          body.innerHTML = `<div><button class="btn btn-primary" id="scan-btn" onclick="runSecurityScan()">Initiate Deep Scan</button><div class="scan-log" id="scan-log" style="margin-top: 1rem; display: none;"></div></div>`;
          break;
        case 'network':
          body.innerHTML = `<div><div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;"><span style="color: #9ca3af; font-size: 14px;">Global Node Status</span><button class="btn btn-secondary btn-small" onclick="refreshNetwork()">Refresh</button></div><div class="network-grid" id="network-grid"></div></div>`;
          refreshNetwork();
          break;
      }
    }
    
    async function sendAIMessage() {
      const input = document.getElementById('ai-input');
      const msg = input.value.trim();
      if(!msg) return;
      state.chatHistory.push({ role: 'user', text: msg });
      input.value = '';
      renderFeatureContent('ai'); 
      try {
        const response = await queryAI(msg, "You are NEXUS OS, a helpful sentient operating system assistant.");
        state.chatHistory.push({ role: 'system', text: response });
      } catch (e) { state.chatHistory.push({ role: 'system', text: "Error: " + e.message }); }
      renderFeatureContent('ai');
    }
    
    function scrollAIChat() { const el = document.getElementById('ai-messages'); if(el) el.scrollTop = el.scrollHeight; }
    
    async function runQuantumBenchmark() {
      const container = document.getElementById('quantum-content');
      container.innerHTML = `<p style="color: var(--cyan);">Running quantum simulation via AI...</p>`;
      try {
        const res = await queryAI("Generate a random quantum processing benchmark result. Reply ONLY with a JSON object like: {\"score\": 3200, \"unit\": \"PetaFLOPS\", \"analysis\": \"Brief analysis text.\"}. No markdown.");
        const jsonMatch = res.match(/\{.*\}/s);
        const data = jsonMatch ? JSON.parse(jsonMatch[0]) : {score: "Error", unit: "", analysis: res};
        container.innerHTML = `<p style="color: #9ca3af;">Benchmark Complete</p><div class="benchmark-score">${data.score}</div><div class="benchmark-unit">${data.unit}</div><p style="margin-top: 15px; font-size: 12px; color: #9ca3af;">${data.analysis}</p><button class="btn btn-secondary" style="margin-top: 20px;" onclick="runQuantumBenchmark()">Run Again</button>`;
      } catch(e) { container.innerHTML = `<p style="color: var(--red);">Error: ${e.message}</p><button class="btn btn-secondary" style="margin-top: 20px;" onclick="runQuantumBenchmark()">Retry</button>`; }
    }
    
    async function runSecurityScan() {
      const btn = document.getElementById('scan-btn'); const log = document.getElementById('scan-log');
      btn.style.display = 'none'; log.style.display = 'block'; log.innerHTML = '<div class="scan-line">Connecting to AI Security Core...</div>';
      try {
        const res = await queryAI("Simulate a system security scan. Provide exactly 8 lines of log. Mix of success (green) and warnings (red). Format: strictly '[STATUS] Message'. Example: '[OK] System stable' or '[!!] Threat found'. No extra text.");
        log.innerHTML = ''; const lines = res.split('\n').filter(l => l.trim()); let i = 0;
        const interval = setInterval(() => {
          if(i < lines.length) {
            const line = document.createElement('div'); line.className = 'scan-line';
            if(lines[i].includes('[!!]') || lines[i].includes('[WARN]')) line.classList.add('threat');
            else if(lines[i].includes('[OK]') || lines[i].includes('[DONE]')) line.classList.add('success');
            line.innerText = "> " + lines[i].replace(/\*\*/g, ''); log.appendChild(line); log.scrollTop = log.scrollHeight; i++;
          } else { clearInterval(interval); btn.style.display = 'block'; btn.innerText = "Scan Complete"; btn.disabled = true; btn.classList.add('btn-secondary'); btn.classList.remove('btn-primary'); }
        }, 400);
      } catch(e) { log.innerHTML += `<div class="scan-line threat">Error: ${e.message}</div>`; btn.style.display = 'block'; }
    }
    
    async function refreshNetwork() {
      const grid = document.getElementById('network-grid'); if(!grid) return;
      grid.innerHTML = '<div style="grid-column: 1/-1; text-align:center; color:#666;">Querying AI Network Status...</div>';
      try {
        const res = await queryAI("Generate network status for 4 regions: NA-East, EU-West, Asia-Tokyo, Oceania. Reply ONLY with a JSON array: [{name: 'Region', ping: 123, status: 'Connected'}].");
        const jsonMatch = res.match(/\[.*\]/s); const data = jsonMatch ? JSON.parse(jsonMatch[0]) : [];
        grid.innerHTML = data.map(r => {
          let cls = 'ping-good'; if(r.ping > 100) cls = 'ping-medium'; if(r.ping > 200) cls = 'ping-bad';
          return `<div class="network-node"><span class="node-name">${r.name}</span><span class="node-ping ${cls}">${r.ping}ms</span></div>`;
        }).join('');
      } catch(e) { grid.innerHTML = `<div style="grid-column: 1/-1; color: var(--red);">Error: ${e.message}</div>`; }
    }
    
    // --- Art Studio Logic ---
    
    function ensurePuterReady() {
      return new Promise((resolve, reject) => {
        let attempts = 0;
        const check = () => {
          if (window.puter && window.puter.ai) resolve(true);
          else if (attempts < 20) { attempts++; setTimeout(check, 200); }
          else reject(new Error("Puter.js failed to load."));
        };
        check();
      });
    }

    function updateArtProgressDOM(percent, text) {
      const container = document.getElementById('art-progress-container');
      const fill = document.getElementById('art-progress-fill');
      const label = document.getElementById('art-status-label');
      const percentEl = document.getElementById('art-status-percent');
      if(container) {
        if(percent > 0) container.classList.add('visible');
        if(fill) fill.style.width = percent + '%';
        if(label) label.innerText = text;
        if(percentEl) percentEl.innerText = percent + '%';
      }
    }
    
    async function generateArt() {
      if (!state.artPrompt || state.artLoading) return;
      state.artLoading = true;
      renderMain();
      let simulatedProgress = 0;
      updateArtProgressDOM(0, 'Connecting to AI Core...');
      const progressInterval = setInterval(() => {
        if (simulatedProgress < 90) { simulatedProgress += Math.floor(Math.random() * 3) + 1; updateArtProgressDOM(simulatedProgress, 'Generating Neural Art...'); }
      }, 200);

      try {
        await ensurePuterReady();
        const options = {};
        if (state.settings.puterArtModel) options.model = state.settings.puterArtModel;
        updateArtProgressDOM(10, 'Sending Request...');
        const response = await window.puter.ai.txt2img(state.artPrompt + ', digital art, cyberpunk, high detail', options);
        clearInterval(progressInterval);
        updateArtProgressDOM(95, 'Processing Image Data...');
        let url = null;
        if (response instanceof HTMLImageElement) url = response.src; 
        else if (typeof response === 'string') url = response;
        else if (response instanceof Blob) url = URL.createObjectURL(response);
        else if (response && typeof response.blob === 'function') { const blob = await response.blob(); url = URL.createObjectURL(blob); }
        else if (response && response.image_url) url = response.image_url;
        else if (response && response.url) url = response.url;
        else throw new Error("Could not parse image response.");
        
        if (url) { updateArtProgressDOM(100, 'Complete!'); state.artImages.unshift(url); showNotification('üé® Image generated!'); }
        else { throw new Error("Empty image URL received."); }
      } catch (e) {
        clearInterval(progressInterval); console.error(e);
        updateArtProgressDOM(0, 'Error: ' + e.message);
        setTimeout(() => { const c = document.getElementById('art-progress-container'); if(c) c.classList.remove('visible'); }, 3000);
        showNotification('‚ö†Ô∏è ' + e.message);
      } finally { setTimeout(() => { state.artLoading = false; renderMain(); }, 1000); }
    }
    
    // --- General Logic ---
    
    function handleCommand(e) {
      if (e.key !== 'Enter') return;
      const input = e.target; const cmd = input.value.trim().toLowerCase(); input.value = '';
      const result = COMMANDS[cmd];
      if (cmd === 'clear') state.terminalHistory = [];
      else if (result) state.terminalHistory.push({ input: cmd, output: result.output, color: result.color });
      else state.terminalHistory.push({ input: cmd, output: `Command not found: ${cmd}`, color: '#ff5f56' });
      renderMain();
      setTimeout(() => { const output = document.getElementById('terminal-output'); if (output) output.scrollTop = output.scrollHeight; const newInput = document.getElementById('terminal-input'); if (newInput) newInput.focus(); }, 50);
    }
    
    function updateSetting(key, value) { state.settings[key] = value; saveSettingsToStorage(); renderMain(); }
    function toggleSetting(key) { state.settings[key] = !state.settings[key]; saveSettingsToStorage(); renderMain(); }
    function resetSettings() { 
      state.settings = { neuralPower: 75, quantumAllocation: 60, memoryCache: 50, biometric: true, quantumEncryption: true, intrusionDetection: true, autoUpdate: false, aiProvider: 'puter', groqKey: '', customEndpoint: '', customKey: '', puterChatModel: 'gpt-5-nano', puterArtModel: 'gpt-image-1.5' }; 
      saveSettingsToStorage(); showNotification('Settings reset to defaults'); renderMain(); 
    }
    
    function showNotification(msg) {
      const notif = document.getElementById('notification');
      notif.textContent = '‚úì ' + msg; notif.classList.remove('hidden');
      setTimeout(() => notif.classList.add('hidden'), 3000);
    }
    
    // --- V14 Feature Logic ---
    
    async function searchRadio() {
      const q = document.getElementById('rad-input')?.value; if(!q) return;
      state.radLoad = true; renderMain();
      try {
        const res = await fetch(`https://de1.api.radio-browser.info/json/stations/search?name=${encodeURIComponent(q)}&limit=20`, { headers: { 'User-Agent': 'NEXUS OS' } });
        const data = await res.json();
        state.radRes = data.map(s => ({ n: s.name, u: s.url_resolved, c: s.country })).filter(s => s.u);
      } catch(e) { showNotification('Search failed'); }
      state.radLoad = false; renderMain();
    }
    
    function playRadio(idx) {
      const s = state.radRes[idx]; if(!s) return;
      if(!state.audio) state.audio = new Audio();
      state.audio.src = s.u;
      state.audio.play().then(() => { state.radSt = s; state.radPlay = true; renderMain(); }).catch(() => showNotification('Stream failed'));
    }
    
    function toggleRadio() {
      if(!state.audio) return;
      if(state.radPlay) { state.audio.pause(); state.radPlay = false; }
      else { state.audio.play(); state.radPlay = true; }
      renderMain();
    }

    function initChat() {
      if(state.chatChan) return;
      const u = state.user?.displayName || 'Guest';
      state.chatChan = new BroadcastChannel('nexus_net_chat_v9');
      state.chatChan.onmessage = (e) => { if(e.data.u !== u) { state.chatMsgs.push({...e.data, self: false}); renderMain(); } };
    }
    
    function sendChat() {
      const msg = state.chatInput; if(!msg) return;
      initChat();
      const u = state.user?.displayName || 'Guest';
      const packet = { u, c: msg };
      state.chatMsgs.push({...packet, self: true});
      state.chatChan.postMessage(packet);
      state.chatInput = ''; renderMain();
    }

    async function searchWeather() {
      const city = state.weatherCity; if(!city) return;
      state.weatherLoad = true; renderMain();
      try {
        const res = await fetch(`https://wttr.in/${encodeURIComponent(city)}?format=j1`);
        const d = await res.json();
        const c = d.current_condition[0];
        const icons = {'113':'‚òÄÔ∏è','116':'‚õÖ','119':'‚òÅÔ∏è','263':'üåßÔ∏è','200':'‚õàÔ∏è','227':'‚ùÑÔ∏è','143':'üå´Ô∏è'};
        state.weather = {
          city: d.nearest_area[0].areaName[0].value, temp: c.temp_C, desc: c.weatherDesc[0].value,
          humidity: c.humidity, wind: c.windspeedKmph, icon: icons[c.weatherCode] || 'üå°Ô∏è'
        };
      } catch(e) { showNotification('Location not found'); }
      state.weatherLoad = false; renderMain();
    }

    function runIDE() {
      const code = document.getElementById('ide-code')?.value || '';
      const iframe = document.getElementById('ide-preview');
      if(iframe) iframe.srcdoc = code;
    }

    function initMonitor() {
      for(let i=0; i<10; i++) { state.sysMon.cpu.push(Math.random()*30+20); state.sysMon.ram.push(Math.random()*20+40); state.sysMon.net.push(Math.random()*10); }
      if(!state.monInterval) {
        state.monInterval = setInterval(() => {
          const push = (arr, val) => { arr.push(val); if(arr.length>10) arr.shift(); };
          push(state.sysMon.cpu, Math.random()*30+20); push(state.sysMon.ram, Math.random()*20+40); push(state.sysMon.net, Math.random()*40);
          if(state.activeNav === 'Monitor') renderMain();
        }, 1000);
      }
    }

    function createNote() { state.notes.unshift({ text: 'New note...', date: new Date().toLocaleDateString() }); saveSettingsToStorage(); renderMain(); }
    function updateNote(idx, text) { state.notes[idx].text = text; saveSettingsToStorage(); }
    function deleteNote(idx) { state.notes.splice(idx, 1); saveSettingsToStorage(); renderMain(); }
    
    runBootSequence();
  </script>
</body>
</html>
